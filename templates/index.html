<!Doctype html>
<html lang="ko">

<head>

    <!-- 상단주소 아이콘-->
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">

    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
          integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
          crossorigin="anonymous">

    <script src="https://kit.fontawesome.com/e917cec6a6.js" crossorigin="anonymous"></script>

    <!-- JS -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
            integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
            crossorigin="anonymous"></script>

    <!-- 구글폰트 -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Do+Hyeon&display=swap" rel="stylesheet">
    <!--벌마 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.1/css/bulma.min.css">

    <script src="https://cdn.jsdelivr.net/npm/bs-custom-file-input/dist/bs-custom-file-input.js"></script>

    <title>오늘의 칼로리 | main</title>

    <!-- style -->
    <style type="text/css">
        * {
            font-family: 'Do Hyeon', sans-serif;
        }
        .jumbotron {
            margin-top: 50px;
            background-color: #72a772;
        }

        .text1 {
            color: white;
        }

        #btn-post-box {
            background-color: rgba(27, 91, 27, 0.88);
        }
        .btn_register{
            margin-top: 20px;
            background-color: #72a772;
        }

        .hero-body {
            background-color: #7ac07a;
        }
        .btn_mypage {
            background-color: #72a772;
        }

        .wrap {
            width: 50%;
            margin: auto;
        }

        .comment {
            color: #396270;
            font-weight: bold;
        }


        #post-box {
            width: 500px;
            margin: 20px auto;
            padding: 50px;
            border: #396270 solid;
            border-radius: 5px;
        }

        #cards-box {

            display: flex;
            justify-content: center;
            padding: 50px 300px 50px 300px;
            margin: auto;



        }
        .section_card {
            display: flex;
            justify-content: center;
            text-align: center;

        }
        .card_made {


        }
        .card_img {
            width: 300px;
            height: 200px;
        }
        .card-body {
            background-color: #ebf6eb;
        }

    </style>
    <script>





        $(document).ready(function () {
            showkcal();
            console.log('{{ user_info }}')
        });

        {#포스트 열고 닫기#}
        function openClose() {
            if ($("#post-box").css("display") == "block") {
                $("#post-box").hide();
                $("#btn-post-box").text("입력하기");
            } else {
                $("#post-box").show();
                $("#btn-post-box").text("닫기");
            }
        }

        {#로그아웃#}
         function sign_out() {
            alert('로그아웃!')
        }

        {#마이프로필로 보내기#}
           function send(){
             $.ajax({
                type: "GET",
                url: "/api/send",
                data: {},
                success: function (response) {
                    let status = response["status"]
                    window.location.href = "/profile?status_give="+status
                }
            });


        }

        {#음식 정보 등록#}
        function postFood() {
            let user_info = '{{ user_info }}';
            let dt =  new Date()
            let date = dt.getFullYear() +"년&nbsp " + (dt.getMonth()+1) +"월&nbsp " + dt.getDate() + "일"
            let now = Date.now();
            let food_name = $('#input_food_name').val()
            let food_date = date
            let food_kca = $('#input_food_kcal').val()
            let food_kcal= parseInt(food_kca)

            let file = $('#file')[0].files[0]
            let form_data = new FormData()

            form_data.append("userinfo_give", user_info)
            form_data.append("file_give", file)
            form_data.append("foodName_give", food_name)
            form_data.append("foodDate_give", food_date)
            form_data.append("foodKcal_give", food_kcal)
            form_data.append("now_give", now)


            $.ajax({
                type: "POST",
                url: "/index",
                data: form_data,
                cache: false,
                contentType: false,
                processData: false,
                success: function (response) {
                    alert(response["msg"])
                    window.location.reload()
                }
            });
        }


        {#음식정보 불러오기#}
        function showkcal() {
            $('#cards-box').empty()
           $.ajax({
               type: "GET",
               url: "/index?user_info={{ user_info }}",
               data: {},
               success: function (response) {
                   let foods = response['all_foods']
                   for (let i = 0; i < foods.length; i++) {
                       let food_name = foods[i]['food_name']
                       let food_date = foods[i]['food_date']
                       let food_kcal = foods[i]['food_kcal']
                       let file = foods[i]['file']


                       let temp_html = `<div class="card card_made">
                                               <img class="card-img-top card_img"
                                                    src="../static/img/${file}"
                                                    alt="Card image cap">
                                               <div class="card-body">
                                                   <a class="card-title">${food_name}</a>
                                                   <p class="card-text comment">${food_kcal} Kcal</p>
                                               </div>
                                           </div>`
                       $('#cards-box').append(temp_html)
                   }
               }
           })
        }

    </script>


</head>

<body>
<nav class="navbar" role="navigation" aria-label="main navigation">
    <div class="navbar-brand">
        <a class="navbar-item" href="./">
            <img src="https://media.vlpt.us/images/kbs2082/post/c8014a5d-dcc9-4961-918b-a4685a9f1259/logo.png" width="112" height="108">
        </a>

        <a role="button" class="navbar-burger" aria-label="menu" aria-expanded="false" data-target="navbarBasicExample">
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
        </a>
    </div>

    <div id="navbarBasicExample" class="navbar-menu">
        <div class="navbar-start">

        </div>
    </div>
    </div>

    <div class="navbar-end">
        <div class="navbar-item">
            <div class="buttons" onclick="send()">
                <a class="button btn_mypage">
                    <strong>My Page</strong>
                </a>
                <a href="login" class="button is-light" onclick="sign_out()">
                    Log out
                </a>
            </div>
        </div>
    </div>
    </div>
</nav>

<section class="hero is-success banner">
    <div class="hero-body">
        <p class="title">
            오늘의 칼로리
        </p>
        <p class="subtitle">
            Write your Kcal
        </p>
    </div>
</section>

<div class="wrap">
    <div class="jumbotron">
        <h1 class="display-4 text1">칼로리 입력기</h1>
        <p class="lead text1">오늘의 칼로리를 입력해 보세요!</p>
        <hr class="my-4">
        <p class="lead">
            <button onclick="openClose()" id="btn-post-box" type="button" class="btn btn-primary">입력하기
            </button>
        </p>
    </div>
    <div id="post-box" class="form-post" style="display:none">
        <div>
            <div class="form-group">
                <label for="input_food_name">음식 이름</label>
                <input id="input_food_name" class="form-control" placeholder="0000">
            </div>
            <div class="form-group">
                <label for="input_food_kcal">칼로리</label>
                <input id="input_food_kcal" class="form-control" placeholder="0000Kcal">
            </div>
            <label for="file-js-example">사진</label>
            <div id="file-js-example" class="file has-name">

                <label class="file-label">
                    <input class="file-input" id="file" type="file" name="resume">
                    <span class="file-cta">
      <span class="file-icon">
        <i class="fas fa-upload"></i>
      </span>
      <span class="file-label">
        파일 찾기
      </span>
    </span>
                    <span class="file-name">
      -------------------------
    </span>
                </label>
            </div>


            <button type="button" class="btn btn-primary btn_register" onclick="postFood()">등록</button>
        </div>
    </div>

</div>

<section class="section_card">
    <div id="cards-box" class="row row-cols-1 row-cols-md-3 g-4">
                <div class="card">
                    <img class="card-img-top"
                         src="https://www.eurail.com/content/dam/images/eurail/Italy%20OCP%20Promo%20Block.adaptive.767.1535627244182.jpg"
                         alt="Card image cap">
                    <div class="card-body">
                        <a target="_blank" href="#" class="card-title">여기 기사 제목이 들어가죠</a>
                        <p class="card-text">기사의 요약 내용이 들어갑니다. 동해물과 백두산이 마르고 닳도록 하느님이 보우하사 우리나라만세 무궁화 삼천리 화려강산...</p>
                        <p class="card-text comment">여기에 코멘트가 들어갑니다.</p>
                    </div>
                </div>
            </div>
</section>

{#파일 첨부를 누르면 그 파일의 이름을 등록칸에 나타내기#}
<script>
    const fileInput = document.querySelector('#file-js-example input[type=file]');
    fileInput.onchange = () => {
        if (fileInput.files.length > 0) {
            const fileName = document.querySelector('#file-js-example .file-name');
            fileName.textContent = fileInput.files[0].name;
        }
    }
</script>
</body>

</html>